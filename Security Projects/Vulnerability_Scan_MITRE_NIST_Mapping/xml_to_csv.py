import pandas as pd
import xml.etree.ElementTree as ET
from lxml import etree
import csv

#META
xml_path = r"C:\Users\jenna\Downloads\cred_meta_report.xml"
tree= ET.parse(xml_path)
root=tree.getroot()
print("------META Vulnerabilities------")
with open("meta_vul.csv","w", newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['Vulnerability Name', 'Host','Port','NVT Name','NVT Family','Severity','CVE'])
    for r in root.iter("result"):
        nvt=r.find('nvt')
        cves=""
        if nvt is not None:
            ref=nvt.find("refs/ref[@type='cve']")
            if ref is not None:
                cves=ref.get("id")
            writer.writerow([r.findtext("name"),r.findtext("host"),r.findtext("port"),r.findtext("nvt/name"),r.findtext("nvt/family"),r.findtext("severity"),cves])

#WINDOWS
xml_path = r"C:\Users\jenna\Downloads\cred_win_report.xml"
tree= ET.parse(xml_path)
root=tree.getroot()
print("------WINDOWS Vulnerabilities------")
with open("win_vul.csv","w", newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['Vulnerability Name', 'Host','Port','NVT Name','NVT Family','Severity', 'CVE'])
    for r in root.iter("result"):
        nvt=r.find('nvt')
        cves=""
        if nvt is not None:
            ref=nvt.find("refs/ref[@type='cve']")
            if ref is not None:
                cves=ref.get("id")
                
            writer.writerow([r.findtext("name"),r.findtext("host"),r.findtext("port"),r.findtext("nvt/name"),r.findtext("nvt/family"),r.findtext("severity"),cves])

#UBUNTU
xml_path = r"C:\Users\jenna\Downloads\cred_ubuntu_report.xml"
tree= ET.parse(xml_path)
root=tree.getroot()
print("------UBUNTU Vulnerabilities------")
with open("ubuntu_vul.csv","w", newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['Vulnerability Name', 'Host','Port','NVT Name','NVT Family','Severity','CVE'])
    for r in root.iter("result"):
        nvt=r.find('nvt')
        cves=""
        if nvt is not None:
            ref=nvt.find("refs/ref[@type='cve']")
            if ref is not None:
                cves=ref.get("id")
                
            writer.writerow([r.findtext("name"),r.findtext("host"),r.findtext("port"),r.findtext("nvt/name"),r.findtext("nvt/family"),r.findtext("severity"),cves])

#DVWA
xml_path = r"C:\Users\jenna\Downloads\cred_dvwa_report.xml"
tree= ET.parse(xml_path)
root=tree.getroot()
print("------DWVA Vulnerabilities------")
with open("dwva_vul.csv","w", newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['Vulnerability Name', 'Host','Port','NVT Name','NVT Family','Severity','CVE'])
    for r in root.iter("result"):
        nvt=r.find('nvt')
        cves=""
        if nvt is not None:
            ref=nvt.find("refs/ref[@type='cve']")
            if ref is not None:
                cves=ref.get("id")
                
        writer.writerow([r.findtext("name"),r.findtext("host"),r.findtext("port"),r.findtext("nvt/name"),r.findtext("nvt/family"),r.findtext("severity"),cves])
